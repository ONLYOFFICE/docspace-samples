<!--
Example: Create file

This example demonstrates how to create a new file inside a DocSpace room using a button.

Using methods:
- DocSpace.SDK.initRoomSelector (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDK/#initroomselector)
- manager.createFile (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDKInstance/#createfile)
-->

<!-- Step 1: HTML Setup -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="{PORTAL_SRC}/" />
    <meta charset="UTF-8" />

    <meta name="example-title" content="Create file" />
    <meta
      name="example-description"
      content="Select a room in the selector, enter a file name, and create a new file using the DocSpace JavaScript SDK."
    />
    <meta name="example-group" content="basic" />

    <title>Create File</title>

    <script src="{PORTAL_SRC}/static/scripts/sdk/2.0.0/api.js"></script>

    
  
    <!-- App styles -->
    <script>
      (function () {
        var link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = new URL("../assets/css/style.css", window.location.href).toString();
        document.head.appendChild(link);
      })();
    </script>

</head>

  <body class="ex-create-file">
    <div class="wrap">
      <iframe id="ds-frame"></iframe>
    </div>

    <iframe id="ds-manager-frame"></iframe>

    <div class="action-bar">
      <input id="fileName" type="text" placeholder="new.pptx" autocomplete="off" />
      <button id="button" disabled>Create File</button>
    </div>

    <script>
      const button = document.getElementById("button");
      const input = document.getElementById("fileName");

      let targetId = null;
      let managerReady = false;

      function extractId(data) {
        const item = Array.isArray(data) ? data[0] : data;
        return item?.folderId ?? item?.roomId ?? item?.id ?? null;
      }

      function updateButtonState() {
        button.disabled = !managerReady || !targetId || !input.value.trim();
      }

      DocSpace.SDK.initRoomSelector({
        frameId: "ds-frame",
        width: "960px",
        height: "640px",
        theme: "base",
        events: {
          onSelectCallback: (data) => {
            targetId = extractId(data);
            updateButtonState();
          }
        }
      });

      const manager = DocSpace.SDK.initManager({
        frameId: "ds-manager-frame",
        theme: "base",
        width: "0px",
        height: "0px",
        events: {
          onAppReady: () => {
            managerReady = true;
            updateButtonState();
          }
        }
      });

      input.addEventListener("input", updateButtonState);

      button.onclick = async () => {
        const name = input.value.trim();
        if (!name) return;

        button.disabled = true;
        await manager.createFile(String(targetId), name);
        button.disabled = false;
      };
    </script>
  </body>
</html>
