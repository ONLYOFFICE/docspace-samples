<!--
Example: Two-factor authentication

This example demonstrates a two-step verification process using a phone number and 4-digit code before granting access to DocSpace via the SDK.
Once verified, users are redirected to a file management interface embedded in an iframe.

Using methods:
- DocSpace.SDK.initManager (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDK/#initmanager)
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="{PORTAL_SRC}/" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="example-title" content="Two-Factor Authentication" />
    <meta
      name="example-description"
      content="Phone + 4-digit code verification before unlocking DocSpace in an iframe. All UI elements are visible on one page."
    />
    <meta name="example-group" content="advanced" />

    <title>Two-Factor Authentication</title>
    <script src="{PORTAL_SRC}/static/scripts/sdk/2.0.0/api.js"></script>

    <!-- App styles -->
    <script>
      (function () {
        var link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = new URL("../assets/css/style.css", window.location.href).toString();
        document.head.appendChild(link);
      })();
    </script>
  </head>

  <body class="ex-two-factor-authentication">
    <div class="page">
      <!-- Left: 2FA panel -->
      <div class="card">
        <h2 class="title">Two-Factor Authentication</h2>
        <p class="desc">
          Enter a phone number, generate a 4-digit code, then verify it to unlock DocSpace.
        </p>

        <label for="inputPhone">Phone number</label>
        <div class="row">
          <input type="tel" id="inputPhone" placeholder="Phone Number" />
          <button id="btnPhone" type="button">Generate code</button>
        </div>

        <label for="inputCode">Verification code</label>
        <div class="row">
          <input type="text" id="inputCode" placeholder="4-digit Code" maxlength="4" />
          <button id="btnCode" type="button" disabled>Verify</button>
        </div>

        <div class="hint" id="hint">Enter a phone number to generate a code.</div>
      </div>

      <!-- Right: DocSpace iframe -->
      <div class="frameWrap">
        <iframe id="ds-frame" class="frame" title="DocSpace"></iframe>
      </div>
    </div>

    <script>
      const elPhone = document.getElementById("inputPhone");
      const elBtnPhone = document.getElementById("btnPhone");

      const elCode = document.getElementById("inputCode");
      const elBtnCode = document.getElementById("btnCode");

      const hint = document.getElementById("hint");

      let generatedCode = "";
      let managerInited = false;

      function setHint(text) {
        hint.textContent = text;
      }

      function updateVerifyState() {
        const code = elCode.value.trim();
        elBtnCode.disabled = !generatedCode || code.length !== 4;
      }

      elPhone.addEventListener("input", () => {
        const phone = elPhone.value.trim();
        if (!phone) {
          setHint("Enter a phone number to generate a code.");
          return;
        }
        setHint("Click “Generate code”.");
      });

      elCode.addEventListener("input", updateVerifyState);

      elBtnPhone.addEventListener("click", () => {
        const phone = elPhone.value.trim();
        if (!phone) {
          alert("Please enter a phone number");
          elPhone.focus();
          return;
        }

        generatedCode = String(Math.floor(1000 + Math.random() * 9000));
        alert("Your verification code is: " + generatedCode);

        setHint("Enter the 4-digit code and click “Verify”.");
        elCode.focus();
        updateVerifyState();
      });

      elBtnCode.addEventListener("click", () => {
        const code = elCode.value.trim();

        if (!generatedCode) {
          setHint("Generate a code first.");
          return;
        }

        if (code !== generatedCode) {
          alert("Authorization error: Invalid verification code");
          setHint("Invalid code. Try again.");
          elCode.focus();
          return;
        }

        setHint("Verified. DocSpace unlocked.");

        if (managerInited) return;
        managerInited = true;

        DocSpace.SDK.initManager({
          frameId: "ds-frame",
          width: "100%",
          height: "700px"
        });
      });

      updateVerifyState();
    </script>
  </body>
</html>
