<!--
Example: Manage project folders

This example shows how to create a simple project tracker that interacts with DocSpace.
Each project is represented as a folder inside a shared room.
You can add or remove projects, and when a project is deleted, all associated files are locked using the ONLYOFFICE API.

Using methods:
- DocSpace.SDK.initManager (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDK/#initmanager)
- manager.createRoom (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDKInstance/#createroom)
- manager.createFolder (https://api.onlyoffice.com/docspace/javascript-sdk/usage-sdk/classes/SDKInstance/#createfolder)
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="{PORTAL_SRC}/" />
    <meta charset="UTF-8" />

    <meta name="example-title" content="Project Manager Folder Integration" />
    <meta name="example-description" content="Create a project room, generate a project folder structure, and open it in the embedded manager." />
    <meta name="example-group" content="advanced" />

    <title>Project Manager Folder Integration</title>
    <script src="{PORTAL_SRC}/static/scripts/sdk/2.0.0/api.js"></script>

    
  
    <!-- App styles -->
    <script>
      (function () {
        var link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = new URL("../assets/css/style.css", window.location.href).toString();
        document.head.appendChild(link);
      })();
    </script>

</head>

  <body class="ex-project-manager-folder-integration">
    <div class="page">
      <div class="card">
        <h3 style="margin:0 0 8px;">Project</h3>
        <div class="hint">Creates a new room + folders for your project. No direct REST calls (no CORS issues).</div>

        <label for="title">Project title</label>
        <input id="title" type="text" placeholder="Website redesign" />

        <button id="createBtn" type="button" disabled>Create project</button>

        <div class="hint" id="status">Waiting…</div>
        <div style="margin-top:10px;">
          <textarea id="out" readonly placeholder="Room and folder IDs will appear here…"></textarea>
        </div>
      </div>

      <div class="card" style="padding:0;">
        <iframe id="ds-frame" class="frame"></iframe>
      </div>
    </div>

    <script>
      const titleInput = document.getElementById("title");
      const createBtn = document.getElementById("createBtn");
      const status = document.getElementById("status");
      const out = document.getElementById("out");

      function setOut(obj) {
        out.value = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
      }

      function updateState() {
        createBtn.disabled = !managerReady || !titleInput.value.trim();
      }

      let managerReady = false;

      const manager = DocSpace.SDK.initManager({
        frameId: "ds-frame",
        width: "100%",
        height: "520px",
        theme: "base",
        events: {
          onAppReady: () => {
            managerReady = true;
            status.textContent = "Ready";
            updateState();
          },
          onAppError: () => {
            status.textContent = "Error";
          }
        }
      });

      titleInput.addEventListener("input", updateState);

      async function createFolders(roomId) {
        const structure = [
          "01 - Brief",
          "02 - Design",
          "03 - Development",
          "04 - Delivery"
        ];

        const created = [];
        for (const name of structure) {
          try {
            const folder = await manager.createFolder(String(roomId), name);
            created.push(folder);
          } catch {}
        }
        return created;
      }

      createBtn.onclick = async () => {
        const title = titleInput.value.trim();
        if (!title) return;

        createBtn.disabled = true;
        status.textContent = "Creating…";
        setOut("");

        try {
          const room = await manager.createRoom(title, 2);
          if (!room || !room.id) throw new Error("Room was not created");

          const folders = await createFolders(room.id);

          manager.setConfig({
            rootPath: "/rooms/shared/" + room.id,
            filter: { folder: String(room.id) },
            showHeader: false
          });

          status.textContent = "Done";
          setOut({ room, folders });
        } catch (e) {
          status.textContent = "Error";
          setOut(e && (e.message || e) ? String(e.message || e) : "Failed");
        } finally {
          updateState();
        }
      };
    </script>
  </body>
</html>
